<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: dashboard-livewidget/js/widgets/livewidget/api/LocalFiltersAPI.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: dashboard-livewidget/js/widgets/livewidget/api/LocalFiltersAPI.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Licensed Materials - Property of IBM
 * IBM Cognos Products: Dashboard (C) Copyright IBM Corp. 2018, 2019
 * US Government Users Restricted Rights - Use, duplication or disclosure restricted by GSA ADP Schedule Contract with IBM Corp.
 */
define([
	'underscore',
	'../../../filters/VisFilterProxy',
	'../../../visualizations/renderer/filter/FilterLabelHelper'
],
function(_, FilterProxy, FilterLabelHelper) {
	'use strict';

	return class LocalFiltersAPI {

		/**
		 * Enumeration of filter condition operators
		 * @public
		 * @enum
		 */
		static get CONDITIONS_OPERATORS() {
			return {
				EQUALS: 'in',
				CONTAINS: 'containsignorecase',
				STARTS_WITH: 'beginswith',
				ENDS_WITH: 'endswith'
			};
		}

		constructor (visAPI) {
			this._visAPI = visAPI;
			this._localFilters = visAPI.getLocalFilters();
			this._proxy = new FilterProxy({
				input: this._localFilters,
				output: this._localFilters
			});
		}

		/**
		 * Get the list of filter UI descriptions
		 * @public
		 * @function LocalFiltersAPI#getFiltersDesc
		 * @returns {Object[]} array of filter descriptions
		 */
		getFiltersDesc() {
			const filterLabelHelper = new FilterLabelHelper({ 'visAPI' : this._visAPI });
			const filters = this._visAPI.getFilterInfo();
			if (filters.localFilters.length > 0) {
				return filterLabelHelper.generateFilterListItems(filters.localFilters);
			}
			return [];
		}

		/**
		 * @function LocalFiltersAPI#getFilterList
		 * @description Get the list of local filter specifications
		 * @returns {Object[]} array of local filter specifications
		 */
		getFilterList() {
			return this._localFilters &amp;&amp; this._localFilters.toJSON();
		}

		/**
		 * Check whether a local filter for a data item exists or not
		 * @public
		 * @function LocalFiltersAPI#filterExists
		 * @param {Object} itemContext Context that describes a data item
		 * @param {string} itemContext.itemId data item identifier
		 * @param {string[]} [itemContext.itemIds] data item identifiers for data point filters
		 * @param {string} [item.aggregationType] data item aggregation type
		 * @returns {boolean} true if a local filter for the data item exists, otherwise false
		 */
		filterExists(itemContext) {
			const key = this._getKey(itemContext);
			return !!this._localFilters.getFilterEntry(key);
		}

		_setOptionToLegacyOptions(setOptions){
			const options = {};
			if(setOptions &amp;&amp; setOptions.transactionId){
				options.payloadData = {
					undoRedoTransactionId: setOptions.transactionId
				};
			}
			return options;
		}

		/**
		 * Add a new local filter to the widget
		 * @public
		 * @async
		 * @function LocalFiltersAPI#addFilter
		 * @param {Object} itemContext Context that describes a data item
		 * @param {string} itemContext.itemId data item identifier
		 * @param {string[]} [itemContext.itemIds] data item identifiers for data point filters
		 * @param {string} [itemContext.aggregationType] data item aggregation type
		 * @param {Object} [filterContext] Filter context object
		 * @param {Object[]} [filterContext.values] Array of values applied to the filter
		 * @param {Object} [filterContext.from] Start range value
		 * @param {Object} [filterContext.to] End range value
		 * @param {boolean} [filterContext.exclude] Use filter values as exclusions
		 * @param {Object} [filterContext.conditionsInfo] filter conditions information
		 * @param {Object} [filterContext.conditionsInfo.conditions] filter conditions
		 * @param {Object} [filterContext.conditionsInfo.conditions.operator = 'containsignorecase'] filter condition operator
		 * @param {Object} [filterContext.conditionsInfo.conditions.values] filter condition values
		 * @param {string[]} [filterContext.conditionsInfo.excludedValues = []]
		 * @example
		 *	filters.addFilter({
		 *		itemId: 'sales_and_marketing_csv.Product_line'
		 *	}, {
		 *		values: [{
		 *			u: 'sales_and_marketing_csv.Year_->[2006]',
		 *			d: '2006'
		 *		}]
		 *	});
		 *
		 *	filters.addFilter({
		 *		itemId: 'sales_and_marketing_csv.Quantity'
		 *	}, {
		 *		from: {
		 *			u: 0,
		 *			d: 0
		 *		},
		 *		to: {
		 *			u: 500000,
		 *			d: 500000
	 	 *		}
		 *	});
		 */
		addFilter(itemContext, filterContext, setOptions) {
			this._updateFilter(itemContext, filterContext, setOptions);
		}

		/**
		 * Edit an existing filter
		 * @public
		 * @async
		 * @function LocalFiltersAPI#editFilter
		 * @param {Object} itemContext Context that describes a data item
		 * @param {string} itemContext.itemId data item identifier
		 * @param {string[]} [itemContext.itemIds] data item identifiers for data point filters
		 * @param {string} [itemContext.aggregationType] data item aggregation type
		 * @param {Object} [filterContext] Filter context object
		 * @param {Object[]} [filterContext.values] Array of values applied to the filter
		 * @param {Object} [filterContext.from] Start range value
		 * @param {Object} [filterContext.to] End range value
		 * @param {boolean} [filterContext.exclude] Use filter values as exclusions
		 * @example
		 *	filters.editFilter({
		 *		itemId: 'sales_and_marketing_csv.Product_line'
		 *	}, {
		 *		values: [{
		 *			u: 'sales_and_marketing_csv.Year_->[2006]',
		 *			d: '2006'
		 *		}]
		 *	});
		 */
		editFilter(itemContext, filterContext, setOptions) {
			// ensure the filter already exists
			if (!this.filterExists(itemContext)) {
				return;
			}

			this._updateFilter(itemContext, filterContext, setOptions);
		}

		/**
		 * Remove an existing filter
		 * @public
		 * @async
		 * @function LocalFiltersAPI#removeFilter
		 * @param {Object} itemContext Context that describes a data item
		 * @param {string} itemContext.itemId data item identifier
		 * @param {string[]} [itemContext.itemIds] data item identifiers for data point filters
		 * @param {string} [item.aggregationType] data item aggregation type
		 * @example
		 *	filters.removeFilter({
		 *		itemId: 'sales_and_marketing_csv.Product_line'
		 *	});
		 */
		removeFilter(itemContext, setOptions) {
			const options = this._setOptionToLegacyOptions(setOptions);

			if (this.filterExists(itemContext)) {
				let key = this._getKey(itemContext);
				if (this._localFilters.removeFilterEntry(key)) {
					this._localFilters.allFilterModificationComplete(options);
					return true;
				}
			}
			return false;
		}

		_getKey (itemContext) {
			if (itemContext.itemIds) {
				return {
					id: this._localFilters.getDataPointFilterKey(itemContext.itemIds)
				};
			}
			const filterType = itemContext.aggregationType ? this._localFilters.FILTERTYPE_ORDINAL : this._localFilters.FILTERTYPE_CATEGORY;
			return this._localFilters.getKey(itemContext.itemId, filterType, itemContext.aggregationType);
		}

		_updateFilter(itemContext, filterContext, setOptions) {

			const options = this._setOptionToLegacyOptions(setOptions);

			if (filterContext.from || filterContext.to) {
				this._proxy.updateRangeFilter(itemContext, filterContext, options);
			} else if (!itemContext.itemId &amp;&amp; _.isArray(itemContext.itemIds)) {
				_.defaults(filterContext, {
					action: 'keepexclude',
					exclude: false
				});
				this._proxy.addDataPoints(itemContext, filterContext, options);
			} else {
				//supply defaults to the conditions in case the itemId, operator, or valueType is omitted. This handles the case where
				//there are multiple conditions (and, or)
				if (filterContext.conditionsInfo &amp;&amp; filterContext.conditionsInfo.conditions) {
					this._updateFilterDefaults(itemContext, filterContext.conditionsInfo.conditions);
				}
				this._proxy.updateFilter(itemContext, filterContext, options);
			}
		}

		_updateFilterDefaults(itemContext, conditions){
			const compound = conditions.and || conditions.or;
			if (compound) {
				_.each(compound, (condition) => {
					this._updateFilterDefaults(itemContext, condition);
				});
			} else{
				_.defaults(conditions, {
					itemId: itemContext.itemId,
					operator: LocalFiltersAPI.CONDITIONS_OPERATORS.CONTAINS,
					valueType: 'display'
				});
			}
		}
	};
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AlignAPI.html">AlignAPI</a></li><li><a href="AssetPrintAPI.html">AssetPrintAPI</a></li><li><a href="CanvasAPI.html">CanvasAPI</a></li><li><a href="ChangeVisTypeActionAPI.html">ChangeVisTypeActionAPI</a></li><li><a href="CoachMarkAPI.html">CoachMarkAPI</a></li><li><a href="ColorsAPI.html">ColorsAPI</a></li><li><a href="ConditionalFormattingAPI.html">ConditionalFormattingAPI</a></li><li><a href="ContentAPI.html">ContentAPI</a></li><li><a href="ContentFactory.html">ContentFactory</a></li><li><a href="ContentServiceabilityAPI.html">ContentServiceabilityAPI</a></li><li><a href="CustomGroupActionAPI.html">CustomGroupActionAPI</a></li><li><a href="DashboardAPI.html">DashboardAPI</a></li><li><a href="DashboardServiceabilityAPI.html">DashboardServiceabilityAPI</a></li><li><a href="DataItemAPI.html">DataItemAPI</a></li><li><a href="DataPointActionsAPI.html">DataPointActionsAPI</a></li><li><a href="DataQueryExecutionAPI.html">DataQueryExecutionAPI</a></li><li><a href="DataSourceAPI.html">DataSourceAPI</a></li><li><a href="DataSourcesAPI.html">DataSourcesAPI</a></li><li><a href="DecoratorAPI.html">DecoratorAPI</a></li><li><a href="EventGroupAPI.html">EventGroupAPI</a></li><li><a href="GlobalFiltersAPI.html">GlobalFiltersAPI</a></li><li><a href="InternalDataQueryExecutionAPI.html">InternalDataQueryExecutionAPI</a></li><li><a href="InternalQueryServiceAPI.html">InternalQueryServiceAPI</a></li><li><a href="InternalRecommenderAPI.html">InternalRecommenderAPI</a></li><li><a href="InternalVisDefinitionsAPI.html">InternalVisDefinitionsAPI</a></li><li><a href="InternalVisualizationAPI.html">InternalVisualizationAPI</a></li><li><a href="MetadataColumnAPI.html">MetadataColumnAPI</a></li><li><a href="PrintAPI.html">PrintAPI</a></li><li><a href="PropertiesAPI.html">PropertiesAPI</a></li><li><a href="PropertiesProviderAPI.html">PropertiesProviderAPI</a></li><li><a href="QueryModifierAPI.html">QueryModifierAPI</a></li><li><a href="QueryProviderAPI.html">QueryProviderAPI</a></li><li><a href="QueryServiceAPI.html">QueryServiceAPI</a></li><li><a href="RenderSequenceAPI.html">RenderSequenceAPI</a></li><li><a href="SavedPromptsAPI.html">SavedPromptsAPI</a></li><li><a href="SegmentAPI.html">SegmentAPI</a></li><li><a href="SlotActionsAPI.html">SlotActionsAPI</a></li><li><a href="SlotAPI.html">SlotAPI</a></li><li><a href="SlotsAPI.html">SlotsAPI</a></li><li><a href="StateAPI.html">StateAPI</a></li><li><a href="TaxonomyAPI.html">TaxonomyAPI</a></li><li><a href="TransactionAPI.html">TransactionAPI</a></li><li><a href="VisDefinitionsAPI.html">VisDefinitionsAPI</a></li><li><a href="VisualizationAPI.html">VisualizationAPI</a></li><li><a href="VizDefinitionAPI.html">VizDefinitionAPI</a></li><li><a href="WidgetAPI.html">WidgetAPI</a></li></ul><h3>Global</h3><ul><li><a href="global.html#CONDITIONS_OPERATORS">CONDITIONS_OPERATORS</a></li><li><a href="global.html#INITIALIZED">INITIALIZED</a></li><li><a href="global.html#openApplication">openApplication</a></li><li><a href="global.html#RENDERED">RENDERED</a></li><li><a href="global.html#RENDERING">RENDERING</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.2</a> on Sat Jun 22 2019 17:31:27 GMT-0400 (EDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
